function OpenAssessmentEditor(a,b){var c=new OpenAssessment.Server(a,b);new OpenAssessment.StudioView(a,b,c)}"undefined"!=typeof OpenAssessment&&OpenAssessment||(OpenAssessment={}),"undefined"==typeof window.gettext&&(window.gettext=function(a){return a}),"undefined"==typeof window.ngetgext&&(window.ngettext=function(a,b,c){return c>1?b:a}),"undefined"==typeof window.Logger&&(window.Logger={log:function(a,b,c){}}),"undefined"==typeof window.MathJax&&(window.MathJax={Hub:{Typeset:function(a){},Queue:function(a){}}}),"undefined"!=typeof OpenAssessment.Server&&OpenAssessment.Server||(OpenAssessment.Server=function(a,b){this.runtime=a,this.element=b},OpenAssessment.Server.prototype={url:function(a){return this.runtime.handlerUrl(this.element,a)},render:function(a){var c=this.url("render_"+a);return $.Deferred(function(a){$.ajax({url:c,type:"POST",dataType:"html"}).done(function(b){a.resolveWith(this,[b])}).fail(function(b){a.rejectWith(this,[gettext("This section could not be loaded.")])})}).promise()},renderLatex:function(a){a.filter(".allow--latex").each(function(){MathJax.Hub.Queue(["Typeset",MathJax.Hub,this])})},renderContinuedPeer:function(){var b=this.url("render_peer_assessment");return $.Deferred(function(a){$.ajax({url:b,type:"POST",dataType:"html",data:{continue_grading:!0}}).done(function(b){a.resolveWith(this,[b])}).fail(function(b){a.rejectWith(this,[gettext("This section could not be loaded.")])})}).promise()},studentInfo:function(a){var b=this.url("render_student_info");return $.Deferred(function(c){$.ajax({url:b,type:"POST",dataType:"html",data:{student_username:a}}).done(function(a){c.resolveWith(this,[a])}).fail(function(a){c.rejectWith(this,[gettext("This section could not be loaded.")])})}).promise()},submit:function(a){var b=this.url("submit");return $.Deferred(function(c){$.ajax({type:"POST",url:b,data:JSON.stringify({submission:a})}).done(function(a){var b=a[0];if(b){var d=a[1],e=a[2];c.resolveWith(this,[d,e])}else{var f=a[1],g=a[2];c.rejectWith(this,[f,g])}}).fail(function(a){c.rejectWith(this,["AJAX",gettext("This response could not be submitted.")])})}).promise()},save:function(a){var b=this.url("save_submission");return $.Deferred(function(c){$.ajax({type:"POST",url:b,data:JSON.stringify({submission:a})}).done(function(a){a.success?c.resolve():c.rejectWith(this,[a.msg])}).fail(function(a){c.rejectWith(this,[gettext("This response could not be saved.")])})}).promise()},submitFeedbackOnAssessment:function(a,b){var c=this.url("submit_feedback"),d=JSON.stringify({feedback_text:a,feedback_options:b});return $.Deferred(function(a){$.ajax({type:"POST",url:c,data:d}).done(function(b){b.success?a.resolve():a.rejectWith(this,[b.msg])}).fail(function(b){a.rejectWith(this,[gettext("This feedback could not be submitted.")])})}).promise()},peerAssess:function(a,b,c,d){var e=this.url("peer_assess"),f=JSON.stringify({options_selected:a,criterion_feedback:b,overall_feedback:c,submission_uuid:d});return $.Deferred(function(a){$.ajax({type:"POST",url:e,data:f}).done(function(b){b.success?a.resolve():a.rejectWith(this,[b.msg])}).fail(function(b){a.rejectWith(this,[gettext("This assessment could not be submitted.")])})}).promise()},selfAssess:function(a,b,c){var d=this.url("self_assess"),e=JSON.stringify({options_selected:a,criterion_feedback:b,overall_feedback:c});return $.Deferred(function(a){$.ajax({type:"POST",url:d,data:e}).done(function(b){b.success?a.resolve():a.rejectWith(this,[b.msg])}).fail(function(b){a.rejectWith(this,[gettext("This assessment could not be submitted.")])})})},trainingAssess:function(a){var b=this.url("training_assess"),c=JSON.stringify({options_selected:a});return $.Deferred(function(a){$.ajax({type:"POST",url:b,data:c}).done(function(b){b.success?a.resolveWith(this,[b.corrections]):a.rejectWith(this,[b.msg])}).fail(function(b){a.rejectWith(this,[gettext("This assessment could not be submitted.")])})})},scheduleTraining:function(){var a=this.url("schedule_training");return $.Deferred(function(b){$.ajax({type:"POST",url:a,data:'""'}).done(function(a){a.success?b.resolveWith(this,[a.msg]):b.rejectWith(this,[a.msg])}).fail(function(a){b.rejectWith(this,[gettext("This assessment could not be submitted.")])})})},rescheduleUnfinishedTasks:function(){var a=this.url("reschedule_unfinished_tasks");return $.Deferred(function(b){$.ajax({type:"POST",url:a,data:'""'}).done(function(a){a.success?b.resolveWith(this,[a.msg]):b.rejectWith(this,[a.msg])}).fail(function(a){b.rejectWith(this,[gettext("One or more rescheduling tasks failed.")])})})},updateEditorContext:function(a){var b=this.url("update_editor_context"),c=JSON.stringify({prompts:a.prompts,feedback_prompt:a.feedbackPrompt,feedback_default_text:a.feedback_default_text,title:a.title,submission_start:a.submissionStart,submission_due:a.submissionDue,criteria:a.criteria,assessments:a.assessments,editor_assessments_order:a.editorAssessmentsOrder,allow_file_upload:a.imageSubmissionEnabled,allow_latex:a.latexEnabled,leaderboard_show:a.leaderboardNum});return $.Deferred(function(a){$.ajax({type:"POST",url:b,data:c}).done(function(b){b.success?a.resolve():a.rejectWith(this,[b.msg])}).fail(function(b){a.rejectWith(this,[gettext("This problem could not be saved.")])})}).promise()},checkReleased:function(){var a=this.url("check_released"),b='""';return $.Deferred(function(c){$.ajax({type:"POST",url:a,data:b}).done(function(a){a.success?c.resolveWith(this,[a.is_released]):c.rejectWith(this,[a.msg])}).fail(function(a){c.rejectWith(this,[gettext("The server could not be contacted.")])})}).promise()},getUploadUrl:function(a){var b=this.url("upload_url");return $.Deferred(function(c){$.ajax({type:"POST",url:b,data:JSON.stringify({contentType:a})}).done(function(a){a.success?c.resolve(a.url):c.rejectWith(this,[a.msg])}).fail(function(a){c.rejectWith(this,[gettext("Could not retrieve upload url.")])})}).promise()},getDownloadUrl:function(){var a=this.url("download_url");return $.Deferred(function(b){$.ajax({type:"POST",url:a,data:JSON.stringify({})}).done(function(a){a.success?b.resolve(a.url):b.rejectWith(this,[a.msg])}).fail(function(a){b.rejectWith(this,[gettext("Could not retrieve download url.")])})}).promise()},cancelSubmission:function(a,b){var c=this.url("cancel_submission"),d=JSON.stringify({submission_uuid:a,comments:b});return $.Deferred(function(a){$.ajax({type:"POST",url:c,data:d}).done(function(b){b.success?a.resolveWith(this,[b.msg]):a.rejectWith(this,[b.msg])}).fail(function(b){a.rejectWith(this,[gettext("The submission could not be removed from the grading pool.")])})}).promise()}}),"undefined"!=typeof OpenAssessment&&OpenAssessment||(OpenAssessment={}),"undefined"==typeof window.gettext&&(window.gettext=function(a){return a}),"undefined"==typeof window.ngetgext&&(window.ngettext=function(a,b,c){return c>1?b:a}),"undefined"==typeof window.Logger&&(window.Logger={log:function(a,b,c){}}),"undefined"==typeof window.MathJax&&(window.MathJax={Hub:{Typeset:function(a){},Queue:function(a){}}}),OpenAssessment.Container=function(a,b){this.containerElement=b.containerElement,this.templateElement=b.templateElement,this.addButtonElement=b.addButtonElement,this.removeButtonClass=b.removeButtonClass,this.containerItemClass=b.containerItemClass,this.notifier=b.notifier,this.addRemoveEnabled="undefined"==typeof b.addRemoveEnabled||b.addRemoveEnabled;var c=this;this.createContainerItem=function(b){return new a(b,c.notifier)}},OpenAssessment.Container.prototype={addEventListeners:function(){var a=this;this.addRemoveEnabled?($(this.addButtonElement).click($.proxy(this.add,this)),$("."+this.removeButtonClass,this.containerElement).click(function(b){var c=a.createContainerItem(b.target);a.remove(c)})):($(this.addButtonElement).addClass("is--disabled"),$("."+this.removeButtonClass,this.containerElement).addClass("is--disabled")),$("."+this.containerItemClass,this.containerElement).each(function(b,c){var d=a.createContainerItem(c);d.addEventListeners()})},add:function(){$(this.templateElement).children().first().clone().removeAttr("id").toggleClass("is--hidden",!1).toggleClass(this.containerItemClass,!0).appendTo($(this.containerElement));var a=this,b=$("."+this.containerItemClass,this.containerElement).last();this.addRemoveEnabled?b.find("."+this.removeButtonClass).click(function(b){var c=a.createContainerItem(b.target);a.remove(c)}):b.find("."+this.removeButtonClass).addClass("is--disabled");var c=a.createContainerItem(b);c.addEventListeners(),c.addHandler()},remove:function(a){var b=$(a.element).closest("."+this.containerItemClass),c=this.createContainerItem(b);c.removeHandler(),b.remove()},getItemValues:function(){var a=[],b=this;return $("."+this.containerItemClass,this.containerElement).each(function(c,d){var e=b.createContainerItem(d),f=e.getFieldValues();a.push(f)}),a},getItem:function(a){var b=$("."+this.containerItemClass,this.containerElement).get(a);return void 0!==b?this.createContainerItem(b):null},getAllItems:function(){var a=this;return $("."+this.containerItemClass,this.containerElement).map(function(){return a.createContainerItem(this)})}},OpenAssessment.ItemUtilities={createUniqueName:function(a,b){for(var c=0;c<=a.length;){if(0===a.parent().find("*["+b+"='"+c+"']").length)return c.toString();c++}return c.toString()},refreshOptionString:function(a){var b=$(a).attr("data-points"),c=$(a).attr("data-label"),d=$(a).val();""===c&&(c=gettext("Unnamed Option"));var e=c+" - "+b+" point",f=c+" - "+b+" points",g="";g=""===d?gettext("Not Selected"):isNaN(b)?c:ngettext(e,f,b),$(a).text(g)}},OpenAssessment.Prompt=function(a,b){this.element=a,this.notifier=b},OpenAssessment.Prompt.prototype={getFieldValues:function(){var a={description:this.description()};return a},description:function(a){var b=$(".openassessment_prompt_description",this.element);return OpenAssessment.Fields.stringField(b,a)},addEventListeners:function(){},addHandler:function(){this.notifier.notificationFired("promptAdd",{index:this.element.index()})},removeHandler:function(){this.notifier.notificationFired("promptRemove",{index:this.element.index()})},updateHandler:function(){},validate:function(){return!0},validationErrors:function(){return[]},clearValidationErrors:function(){}},OpenAssessment.RubricOption=function(a,b){this.element=a,this.notifier=b,this.pointsField=new OpenAssessment.IntField($(".openassessment_criterion_option_points",this.element),{min:0,max:999})},OpenAssessment.RubricOption.prototype={addEventListeners:function(){$(this.element).focusout($.proxy(this.updateHandler,this))},getFieldValues:function(){var a={label:this.label(),points:this.points(),explanation:this.explanation()},b=OpenAssessment.Fields.stringField($(".openassessment_criterion_option_name",this.element));return""!==b&&(a.name=b),a},label:function(a){var b=$(".openassessment_criterion_option_label",this.element);return OpenAssessment.Fields.stringField(b,a)},points:function(a){return void 0!==a&&this.pointsField.set(a),this.pointsField.get()},explanation:function(a){var b=$(".openassessment_criterion_option_explanation",this.element);return OpenAssessment.Fields.stringField(b,a)},addHandler:function(){var a=$(this.element).closest(".openassessment_criterion"),b=$(a).data("criterion"),c=$(".openassessment_criterion_label",a).val(),d=$(".openassessment_criterion_option",this.element.parent()),e=OpenAssessment.ItemUtilities.createUniqueName(d,"data-option");$(this.element).attr("data-criterion",b).attr("data-option",e),$(".openassessment_criterion_option_name",this.element).attr("value",e);var f=this.getFieldValues();this.notifier.notificationFired("optionAdd",{criterionName:b,criterionLabel:c,name:e,label:f.label,points:f.points})},removeHandler:function(){var a=$(this.element).data("criterion"),b=$(this.element).data("option");this.notifier.notificationFired("optionRemove",{criterionName:a,name:b})},updateHandler:function(){var a=this.getFieldValues(),b=$(this.element).data("criterion"),c=$(this.element).data("option"),d=a.label,e=a.points;this.notifier.notificationFired("optionUpdated",{criterionName:b,name:c,label:d,points:e})},validate:function(){return this.pointsField.validate()},validationErrors:function(){var a=this.pointsField.validationErrors().length>0;return a?["Option points are invalid"]:[]},clearValidationErrors:function(){this.pointsField.clearValidationErrors()}},OpenAssessment.RubricCriterion=function(a,b){this.element=a,this.notifier=b,this.labelSel=$(".openassessment_criterion_label",this.element),this.promptSel=$(".openassessment_criterion_prompt",this.element),this.optionContainer=new OpenAssessment.Container(OpenAssessment.RubricOption,{containerElement:$(".openassessment_criterion_option_list",this.element).get(0),templateElement:$("#openassessment_option_template").get(0),addButtonElement:$(".openassessment_criterion_add_option",this.element).get(0),removeButtonClass:"openassessment_criterion_option_remove_button",containerItemClass:"openassessment_criterion_option",notifier:this.notifier})},OpenAssessment.RubricCriterion.prototype={addEventListeners:function(){this.optionContainer.addEventListeners(),$(this.element).focusout($.proxy(this.updateHandler,this))},getFieldValues:function(){var a={label:this.label(),prompt:this.prompt(),feedback:this.feedback(),options:this.optionContainer.getItemValues()},b=OpenAssessment.Fields.stringField($(".openassessment_criterion_name",this.element));return""!==b&&(a.name=b),a},label:function(a){return OpenAssessment.Fields.stringField(this.labelSel,a)},prompt:function(a){return OpenAssessment.Fields.stringField(this.promptSel,a)},feedback:function(){return $(".openassessment_criterion_feedback",this.element).val()},addOption:function(){this.optionContainer.add()},addHandler:function(){var a=$(".openassessment_criterion",this.element.parent()),b=OpenAssessment.ItemUtilities.createUniqueName(a,"data-criterion");$(this.element).attr("data-criterion",b),$(".openassessment_criterion_name",this.element).attr("value",b)},removeHandler:function(){var a=$(this.element).data("criterion");this.notifier.notificationFired("criterionRemove",{criterionName:a})},updateHandler:function(){var a=this.getFieldValues(),b=a.name,c=a.label;this.notifier.notificationFired("criterionUpdated",{criterionName:b,criterionLabel:c})},validate:function(){var a=""!==this.prompt();return a||this.promptSel.addClass("openassessment_highlighted_field"),$.each(this.optionContainer.getAllItems(),function(){a=this.validate()&&a}),a},validationErrors:function(){var a=[];return this.promptSel.hasClass("openassessment_highlighted_field")&&a.push("Criterion prompt is invalid."),$.each(this.optionContainer.getAllItems(),function(){a=a.concat(this.validationErrors())}),a},clearValidationErrors:function(){this.promptSel.removeClass("openassessment_highlighted_field"),$.each(this.optionContainer.getAllItems(),function(){this.clearValidationErrors()})}},OpenAssessment.TrainingExample=function(a){this.element=a,this.criteria=$(".openassessment_training_example_criterion_option",this.element),this.answer=$(".openassessment_training_example_essay_part textarea",this.element)},OpenAssessment.TrainingExample.prototype={getFieldValues:function(){var a=this.criteria.map(function(){return{criterion:$(this).data("criterion"),option:$(this).prop("value")}}).get();return{answer:this.answer.map(function(){return $(this).prop("value")}).get(),options_selected:a}},addHandler:function(){$(".openassessment_training_example_criterion_option",this.element).each(function(){$("option",this).each(function(){OpenAssessment.ItemUtilities.refreshOptionString($(this))})})},addEventListeners:function(){},removeHandler:function(){},updateHandler:function(){},validate:function(){var a=!0;return this.criteria.each(function(){var b=""!==$(this).prop("value");a=b&&a,b||$(this).addClass("openassessment_highlighted_field")}),a},validationErrors:function(){var a=[];return this.criteria.each(function(){var b=$(this).hasClass("openassessment_highlighted_field");b&&a.push("Student training example is invalid.")}),a},clearValidationErrors:function(){this.criteria.each(function(){$(this).removeClass("openassessment_highlighted_field")})}},OpenAssessment.StudioView=function(a,b,c){this.element=b,this.runtime=a,this.server=c,this.fixModalHeight(),this.initializeTabs(),this.alert=(new OpenAssessment.ValidationAlert).install();var d=new OpenAssessment.StudentTrainingListener;this.promptsView=new OpenAssessment.EditPromptsView($("#oa_prompts_editor_wrapper",this.element).get(0),new OpenAssessment.Notifier([d]));var e=new OpenAssessment.EditStudentTrainingView($("#oa_student_training_editor",this.element).get(0)),f=new OpenAssessment.EditPeerAssessmentView($("#oa_peer_assessment_editor",this.element).get(0)),g=new OpenAssessment.EditSelfAssessmentView($("#oa_self_assessment_editor",this.element).get(0)),h=new OpenAssessment.EditExampleBasedAssessmentView($("#oa_ai_assessment_editor",this.element).get(0)),i={};i[e.getID()]=e,i[f.getID()]=f,i[g.getID()]=g,i[h.getID()]=h,this.settingsView=new OpenAssessment.EditSettingsView($("#oa_basic_settings_editor",this.element).get(0),i),this.rubricView=new OpenAssessment.EditRubricView($("#oa_rubric_editor_wrapper",this.element).get(0),new OpenAssessment.Notifier([d])),$(".openassessment_save_button",this.element).click($.proxy(this.save,this)),$(".openassessment_cancel_button",this.element).click($.proxy(this.cancel,this))},OpenAssessment.StudioView.prototype={fixModalHeight:function(){$(this.element).addClass("openassessment_full_height").parentsUntil(".modal-window").addClass("openassessment_full_height"),$(this.element).closest(".modal-window").addClass("openassessment_modal_window")},initializeTabs:function(){"undefined"==typeof OpenAssessment.lastOpenEditingTab&&(OpenAssessment.lastOpenEditingTab=2),$(".openassessment_editor_content_and_tabs",this.element).tabs({active:OpenAssessment.lastOpenEditingTab})},saveTabState:function(){var a=$(".openassessment_editor_content_and_tabs",this.element);OpenAssessment.lastOpenEditingTab=a.tabs("option","active")},save:function(){var a=this;this.saveTabState(),this.clearValidationErrors(),this.validate()?(this.alert.hide(),this.server.checkReleased().done(function(b){b?a.confirmPostReleaseUpdate($.proxy(a.updateEditorContext,a)):a.updateEditorContext()}).fail(function(b){a.showError(b)})):this.alert.setMessage(gettext("Couldn't Save This Assignment"),gettext("Please correct the outlined fields.")).show()},confirmPostReleaseUpdate:function(a){var b=gettext("This problem has already been released. Any changes will apply only to future assessments.");confirm(b)&&a()},updateEditorContext:function(){this.runtime.notify("save",{state:"start"});var a=this;this.server.updateEditorContext({prompts:a.promptsView.promptsDefinition(),feedbackPrompt:a.rubricView.feedbackPrompt(),feedback_default_text:a.rubricView.feedback_default_text(),criteria:a.rubricView.criteriaDefinition(),title:a.settingsView.displayName(),submissionStart:a.settingsView.submissionStart(),submissionDue:a.settingsView.submissionDue(),assessments:a.settingsView.assessmentsDescription(),imageSubmissionEnabled:a.settingsView.imageSubmissionEnabled(),latexEnabled:a.settingsView.latexEnabled(),leaderboardNum:a.settingsView.leaderboardNum(),editorAssessmentsOrder:a.settingsView.editorAssessmentsOrder()}).done(function(){a.runtime.notify("save",{state:"end"})}).fail(function(b){a.showError(b)})},cancel:function(){this.saveTabState(),this.runtime.notify("cancel",{})},showError:function(a){this.runtime.notify("error",{msg:a})},validate:function(){var a=this.settingsView.validate(),b=this.rubricView.validate(),c=this.promptsView.validate();return a&&b&&c},validationErrors:function(){return this.settingsView.validationErrors().concat(this.rubricView.validationErrors().concat(this.promptsView.validationErrors()))},clearValidationErrors:function(){this.settingsView.clearValidationErrors(),this.rubricView.clearValidationErrors(),this.promptsView.clearValidationErrors()}},OpenAssessment.EditPeerAssessmentView=function(a){this.element=a,this.name="peer-assessment",this.mustGradeField=new OpenAssessment.IntField($("#peer_assessment_must_grade",this.element),{min:0,max:99}),this.mustBeGradedByField=new OpenAssessment.IntField($("#peer_assessment_graded_by",this.element),{min:0,max:99}),new OpenAssessment.ToggleControl($("#include_peer_assessment",this.element),$("#peer_assessment_settings_editor",this.element),$("#peer_assessment_description_closed",this.element),new OpenAssessment.Notifier([new OpenAssessment.AssessmentToggleListener])).install(),this.startDatetimeControl=new OpenAssessment.DatetimeControl(this.element,"#peer_assessment_start_date","#peer_assessment_start_time").install(),this.dueDatetimeControl=new OpenAssessment.DatetimeControl(this.element,"#peer_assessment_due_date","#peer_assessment_due_time").install()},OpenAssessment.EditPeerAssessmentView.prototype={description:function(){return{must_grade:this.mustGradeNum(),must_be_graded_by:this.mustBeGradedByNum(),start:this.startDatetime(),due:this.dueDatetime()}},isEnabled:function(a){var b=$("#include_peer_assessment",this.element);return OpenAssessment.Fields.booleanField(b,a)},toggleEnabled:function(){$("#include_peer_assessment",this.element).click()},mustGradeNum:function(a){return void 0!==a&&this.mustGradeField.set(a),this.mustGradeField.get()},mustBeGradedByNum:function(a){return void 0!==a&&this.mustBeGradedByField.set(a),this.mustBeGradedByField.get()},startDatetime:function(a,b){return this.startDatetimeControl.datetime(a,b)},dueDatetime:function(a,b){return this.dueDatetimeControl.datetime(a,b)},getID:function(){return $(this.element).attr("id")},validate:function(){var a=this.startDatetimeControl.validate(),b=this.dueDatetimeControl.validate(),c=this.mustGradeField.validate(),d=this.mustBeGradedByField.validate();return a&&b&&c&&d},validationErrors:function(){var a=[];return this.startDatetimeControl.validationErrors().length>0&&a.push("Peer assessment start is invalid"),this.dueDatetimeControl.validationErrors().length>0&&a.push("Peer assessment due is invalid"),this.mustGradeField.validationErrors().length>0&&a.push("Peer assessment must grade is invalid"),this.mustBeGradedByField.validationErrors().length>0&&a.push("Peer assessment must be graded by is invalid"),a},clearValidationErrors:function(){this.startDatetimeControl.clearValidationErrors(),this.dueDatetimeControl.clearValidationErrors(),this.mustGradeField.clearValidationErrors(),this.mustBeGradedByField.clearValidationErrors()}},OpenAssessment.EditSelfAssessmentView=function(a){this.element=a,this.name="self-assessment",new OpenAssessment.ToggleControl($("#include_self_assessment",this.element),$("#self_assessment_settings_editor",this.element),$("#self_assessment_description_closed",this.element),new OpenAssessment.Notifier([new OpenAssessment.AssessmentToggleListener])).install(),this.startDatetimeControl=new OpenAssessment.DatetimeControl(this.element,"#self_assessment_start_date","#self_assessment_start_time").install(),this.dueDatetimeControl=new OpenAssessment.DatetimeControl(this.element,"#self_assessment_due_date","#self_assessment_due_time").install()},OpenAssessment.EditSelfAssessmentView.prototype={description:function(){return{start:this.startDatetime(),due:this.dueDatetime()}},isEnabled:function(a){var b=$("#include_self_assessment",this.element);return OpenAssessment.Fields.booleanField(b,a)},toggleEnabled:function(){$("#include_self_assessment",this.element).click()},startDatetime:function(a,b){return this.startDatetimeControl.datetime(a,b)},dueDatetime:function(a,b){return this.dueDatetimeControl.datetime(a,b)},getID:function(){return $(this.element).attr("id")},validate:function(){var a=this.startDatetimeControl.validate(),b=this.dueDatetimeControl.validate();return a&&b},validationErrors:function(){var a=[];return this.startDatetimeControl.validationErrors().length>0&&a.push("Self assessment start is invalid"),this.dueDatetimeControl.validationErrors().length>0&&a.push("Self assessment due is invalid"),a},clearValidationErrors:function(){this.startDatetimeControl.clearValidationErrors(),this.dueDatetimeControl.clearValidationErrors()}},OpenAssessment.EditStudentTrainingView=function(a){this.element=a,this.name="student-training",new OpenAssessment.ToggleControl($("#include_student_training",this.element),$("#student_training_settings_editor",this.element),$("#student_training_description_closed",this.element),new OpenAssessment.Notifier([new OpenAssessment.AssessmentToggleListener])).install(),this.exampleContainer=new OpenAssessment.Container(OpenAssessment.TrainingExample,{containerElement:$("#openassessment_training_example_list",this.element).get(0),templateElement:$("#openassessment_training_example_template",this.element).get(0),addButtonElement:$(".openassessment_add_training_example",this.element).get(0),removeButtonClass:"openassessment_training_example_remove",containerItemClass:"openassessment_training_example"}),this.exampleContainer.addEventListeners()},OpenAssessment.EditStudentTrainingView.prototype={description:function(){return{examples:this.exampleContainer.getItemValues()}},isEnabled:function(a){var b=$("#include_student_training",this.element);return OpenAssessment.Fields.booleanField(b,a)},toggleEnabled:function(){$("#include_student_training",this.element).click()},getID:function(){return $(this.element).attr("id")},validate:function(){var a=!0;return $.each(this.exampleContainer.getAllItems(),function(){a=this.validate()&&a}),a},validationErrors:function(){var a=[];return $.each(this.exampleContainer.getAllItems(),function(){a=a.concat(this.validationErrors())}),a},clearValidationErrors:function(){$.each(this.exampleContainer.getAllItems(),function(){this.clearValidationErrors()})},addTrainingExample:function(){this.exampleContainer.add()}},OpenAssessment.EditExampleBasedAssessmentView=function(a){this.element=a,this.name="example-based-assessment",new OpenAssessment.ToggleControl($("#include_ai_assessment",this.element),$("#ai_assessment_settings_editor",this.element),$("#ai_assessment_description_closed",this.element),new OpenAssessment.Notifier([new OpenAssessment.AssessmentToggleListener])).install()},OpenAssessment.EditExampleBasedAssessmentView.prototype={description:function(){return{examples_xml:this.exampleDefinitions()}},isEnabled:function(a){var b=$("#include_ai_assessment",this.element);return OpenAssessment.Fields.booleanField(b,a)},toggleEnabled:function(){$("#include_ai_assessment",this.element).click()},exampleDefinitions:function(a){var b=$("#ai_training_examples",this.element);return OpenAssessment.Fields.stringField(b,a)},getID:function(){return $(this.element).attr("id")},validate:function(){return!0},validationErrors:function(){return[]},clearValidationErrors:function(){}},OpenAssessment.Fields={stringField:function(a,b){return void 0!==b&&a.val(b),a.val()},booleanField:function(a,b){return void 0!==b&&a.prop("checked",b),a.prop("checked")}},OpenAssessment.IntField=function(a,b){this.max=b.max,this.min=b.min,this.input=$(a)},OpenAssessment.IntField.prototype={get:function(){return parseInt(this.input.val().trim(),10)},set:function(a){this.input.val(a)},validate:function(){var a=this.get(),b=!isNaN(a)&&a>=this.min&&a<=this.max;return this.input.val().indexOf(".")!==-1&&(b=!1),b||this.input.addClass("openassessment_highlighted_field"),b},clearValidationErrors:function(){this.input.removeClass("openassessment_highlighted_field")},validationErrors:function(){var a=this.input.hasClass("openassessment_highlighted_field");return a?["Int field is invalid"]:[]}},OpenAssessment.ToggleControl=function(a,b,c,d){this.checkbox=a,this.shownSection=b,this.hiddenSection=c,this.notifier=d},OpenAssessment.ToggleControl.prototype={install:function(a){return this.checkbox.change(this,function(a){var b=a.data;this.checked?(b.notifier.notificationFired("toggleOn",{}),b.show()):(b.notifier.notificationFired("toggleOff",{}),b.hide())}),this},show:function(){this.shownSection.removeClass("is--hidden"),this.hiddenSection.addClass("is--hidden")},hide:function(){this.shownSection.addClass("is--hidden"),this.hiddenSection.removeClass("is--hidden")}},OpenAssessment.DatetimeControl=function(a,b,c){this.element=a,this.datePicker=b,this.timePicker=c},OpenAssessment.DatetimeControl.prototype={install:function(){var a=$(this.datePicker,this.element).val();return $(this.datePicker,this.element).datepicker({showButtonPanel:!0}).datepicker("option","dateFormat","yy-mm-dd").datepicker("setDate",a),$(this.timePicker,this.element).timepicker({timeFormat:"H:i",step:60}),this},datetime:function(a,b){var c=$(this.datePicker,this.element),d=$(this.timePicker,this.element);return"undefined"!=typeof a&&c.val(a),"undefined"!=typeof b&&d.val(b),c.val()+"T"+d.val()},validate:function(){var a=$(this.datePicker,this.element).val(),b=$(this.timePicker,this.element).val(),c=!1;try{var d=$.datepicker.parseDate($.datepicker.ISO_8601,a);c=d instanceof Date}catch(a){}c||$(this.datePicker,this.element).addClass("openassessment_highlighted_field");var e=b.match(/^\d{2}:\d{2}$/g),f=null!==e;return f||$(this.timePicker,this.element).addClass("openassessment_highlighted_field"),c&&f},clearValidationErrors:function(){$(this.datePicker,this.element).removeClass("openassessment_highlighted_field"),$(this.timePicker,this.element).removeClass("openassessment_highlighted_field")},validationErrors:function(){var a=[],b=$(this.datePicker,this.element).hasClass("openassessment_highlighted_field"),c=$(this.timePicker,this.element).hasClass("openassessment_highlighted_field");return b&&a.push("Date is invalid"),c&&a.push("Time is invalid"),a}},OpenAssessment.StudentTrainingListener=function(){this.element=$("#oa_student_training_editor"),this.alert=new OpenAssessment.ValidationAlert},OpenAssessment.StudentTrainingListener.prototype={promptAdd:function(a){var b=this.element;$("#openassessment_training_example_part_template").children().first().clone().removeAttr("id").toggleClass("is--hidden",!1).appendTo(".openassessment_training_example_essay",b)},promptRemove:function(a){var b=this.element;$(".openassessment_training_example_essay li:nth-child("+(a.index+1)+")",b).remove()},optionUpdated:function(a){this._optionSel(a.criterionName).each(function(){var b=this,c=$('option[value="'+a.name+'"]',b).attr("data-points",a.points).attr("data-label",a.label);OpenAssessment.ItemUtilities.refreshOptionString(c)})},optionAdd:function(a){var b=!1;0===this._optionSel(a.criterionName).length&&(this.criterionAdd(a),b=!0),this._optionSel(a.criterionName).each(function(){var b=this,c=$("<option></option>").attr("value",a.name).attr("data-points",a.points).attr("data-label",a.label);OpenAssessment.ItemUtilities.refreshOptionString(c),$(b).append(c)}),b&&this.displayAlertMsg(gettext("Criterion Added"),gettext("You've added a criterion. You'll need to select an option for the criterion in the Student Training step. To do this, click the Settings tab."))},optionRemove:function(a){var b=this,c=!1;this._optionSel(a.criterionName).each(function(){var d=this;$(d).val()===a.name.toString()&&($(d).val("").addClass("openassessment_highlighted_field").click(function(){$(d).removeClass("openassessment_highlighted_field")}),c=!0),$('option[value="'+a.name+'"]',d).remove(),1==$("option",d).length&&(b.removeAllOptions(a),c=!1)}),c&&this.displayAlertMsg(gettext("Option Deleted"),gettext("You've deleted an option. The system has removed that option from its criterion in the sample responses in the Student Training step. You may have to select a new option for the criterion."))},_optionSel:function(a){return $('.openassessment_training_example_criterion_option[data-criterion="'+a+'"]',this.element)},removeAllOptions:function(a){var b=!1;$(".openassessment_training_example_criterion",this.element).each(function(){var c=this;$(c).data("criterion")==a.criterionName&&($(c).remove(),b=!0)}),b&&this.displayAlertMsg(gettext("Option Deleted"),gettext("You've deleted all the options for this criterion. The system has removed the criterion from the sample responses in the Student Training step."));
},criterionRemove:function(a){var b=!1,c='.openassessment_training_example_criterion[data-criterion="'+a.criterionName+'"]';$(c,this.element).each(function(){$(this).remove(),b=!0}),b&&this.displayAlertMsg(gettext("Criterion Deleted"),gettext("You've deleted a criterion. The system has removed the criterion from the sample responses in the Student Training step."))},displayAlertMsg:function(a,b){$("#include_student_training",this.element).is(":checked")&&$(".openassessment_training_example",this.element).length>1&&this.alert.setMessage(a,b).show()},criterionUpdated:function(a){var b='.openassessment_training_example_criterion[data-criterion="'+a.criterionName+'"]';$(b,this.element).each(function(){$(".openassessment_training_example_criterion_name_wrapper",this).text(a.criterionLabel)})},criterionAdd:function(a){var b=this.element,c=$("#openassessment_training_example_criterion_template").children().first().clone().removeAttr("id").attr("data-criterion",a.criterionName).toggleClass("is--hidden",!1).appendTo(".openassessment_training_example_criteria_selections",b);c.find(".openassessment_training_example_criterion_option").attr("data-criterion",a.criterionName),c.find(".openassessment_training_example_criterion_name_wrapper").text(a.label)},examplesCriteriaLabels:function(){var a=[];return $(".openassessment_training_example_criteria_selections",this.element).each(function(){var b={};$(".openassessment_training_example_criterion",this).each(function(){var a=$(this).data("criterion"),c=$(".openassessment_training_example_criterion_name_wrapper",this).text().trim();b[a]=c}),a.push(b)}),a},examplesOptionsLabels:function(){var a=[];return $(".openassessment_training_example_criteria_selections",this.element).each(function(){var b={};$(".openassessment_training_example_criterion_option",this).each(function(){var a=$(this).data("criterion");b[a]={},$("option",this).each(function(){var c=$(this).val(),d=$(this).text().trim();b[a][c]=d})}),a.push(b)}),a}},OpenAssessment.AssessmentToggleListener=function(){this.alert=new OpenAssessment.ValidationAlert},OpenAssessment.AssessmentToggleListener.prototype={toggleOff:function(a){this.alert.setMessage(gettext("Warning"),gettext("Changes to steps that are not selected as part of the assignment will not be saved.")).show()},toggleOn:function(a){this.alert.hide()}},OpenAssessment.Notifier=function(a){this.listeners=a},OpenAssessment.Notifier.prototype={notificationFired:function(a,b){for(var c=0;c<this.listeners.length;c++)"function"==typeof this.listeners[c][a]&&this.listeners[c][a](b)}},OpenAssessment.EditPromptsView=function(a,b){this.element=a,this.editorElement=$(this.element).closest("#openassessment-editor"),this.addRemoveEnabled=!("true"===this.editorElement.attr("data-is-released")),this.promptsContainer=new OpenAssessment.Container(OpenAssessment.Prompt,{containerElement:$("#openassessment_prompts_list",this.element).get(0),templateElement:$("#openassessment_prompt_template",this.element).get(0),addButtonElement:$("#openassessment_prompts_add_prompt",this.element).get(0),removeButtonClass:"openassessment_prompt_remove_button",containerItemClass:"openassessment_prompt",notifier:b,addRemoveEnabled:this.addRemoveEnabled}),this.promptsContainer.addEventListeners()},OpenAssessment.EditPromptsView.prototype={promptsDefinition:function(){var a=this.promptsContainer.getItemValues();return a},addPrompt:function(){this.addRemoveEnabled&&this.promptsContainer.add()},removePrompt:function(a){this.addRemoveEnabled&&this.promptsContainer.remove(a)},getAllPrompts:function(){return this.promptsContainer.getAllItems()},getPromptItem:function(a){return this.promptsContainer.getItem(a)},validate:function(){return!0},validationErrors:function(){var a=[];return a},clearValidationErrors:function(){}},OpenAssessment.EditRubricView=function(a,b){this.element=a,this.criterionAddButton=$("#openassessment_rubric_add_criterion",this.element),this.criteriaContainer=new OpenAssessment.Container(OpenAssessment.RubricCriterion,{containerElement:$("#openassessment_criterion_list",this.element).get(0),templateElement:$("#openassessment_criterion_template",this.element).get(0),addButtonElement:$("#openassessment_rubric_add_criterion",this.element).get(0),removeButtonClass:"openassessment_criterion_remove_button",containerItemClass:"openassessment_criterion",notifier:b}),this.criteriaContainer.addEventListeners()},OpenAssessment.EditRubricView.prototype={criteriaDefinition:function(){for(var a=this.criteriaContainer.getItemValues(),b=0;b<a.length;b++){var c=a[b];c.order_num=b;for(var d=0;d<c.options.length;d++){var e=c.options[d];e.order_num=d}}return a},feedbackPrompt:function(a){var b=$("#openassessment_rubric_feedback",this.element);return OpenAssessment.Fields.stringField(b,a)},feedback_default_text:function(a){var b=$("#openassessment_rubric_feedback_default_text",this.element);return OpenAssessment.Fields.stringField(b,a)},addCriterion:function(){this.criteriaContainer.add()},removeCriterion:function(a){this.criteriaContainer.remove(a)},getAllCriteria:function(){return this.criteriaContainer.getAllItems()},getCriterionItem:function(a){return this.criteriaContainer.getItem(a)},addOption:function(a){var b=this.getCriterionItem(a);b.optionContainer.add()},removeOption:function(a,b){var c=this.getCriterionItem(a);c.optionContainer.remove(b)},getAllOptions:function(a){var b=this.getCriterionItem(a);return b.optionContainer.getAllItems()},getOptionItem:function(a,b){var c=this.getCriterionItem(a);return c.optionContainer.getItem(b)},validate:function(){var a=this.getAllCriteria(),b=a.length>0;return b||this.criterionAddButton.addClass("openassessment_highlighted_field").click(function(){$(this).removeClass("openassessment_highlighted_field")}),$.each(a,function(){b=this.validate()&&b}),b},validationErrors:function(){var a=[];return this.criterionAddButton.hasClass("openassessment_highlighted_field")&&a.push("The rubric must contain at least one criterion"),$.each(this.getAllCriteria(),function(){a=a.concat(this.validationErrors())}),a},clearValidationErrors:function(){this.criterionAddButton.removeClass("openassessment_highlighted_field"),$.each(this.getAllCriteria(),function(){this.clearValidationErrors()})}},OpenAssessment.EditSettingsView=function(a,b){this.settingsElement=a,this.assessmentsElement=$(a).siblings("#openassessment_assessment_module_settings_editors").get(0),this.assessmentViews=b,this.startDatetimeControl=new OpenAssessment.DatetimeControl(this.element,"#openassessment_submission_start_date","#openassessment_submission_start_time").install(),this.dueDatetimeControl=new OpenAssessment.DatetimeControl(this.element,"#openassessment_submission_due_date","#openassessment_submission_due_time").install(),this.leaderboardIntField=new OpenAssessment.IntField($("#openassessment_leaderboard_editor",this.element),{min:0,max:100}),this.initializeSortableAssessments()},OpenAssessment.EditSettingsView.prototype={initializeSortableAssessments:function(){var a=this;$("#openassessment_assessment_module_settings_editors",a.element).sortable({start:function(b,c){$(".openassessment_assessment_module_editor",a.element).hide();var d="auto";c.placeholder.height(d),c.helper.height(d),$("#openassessment_assessment_module_settings_editors",a.element).sortable("refresh").sortable("refreshPositions")},stop:function(b,c){$(".openassessment_assessment_module_editor",a.element).show()},snap:!0,axis:"y",handle:".drag-handle",cursorAt:{top:20}}),$("#openassessment_assessment_module_settings_editors .drag-handle",a.element).disableSelection()},displayName:function(a){var b=$("#openassessment_title_editor",this.settingsElement);return OpenAssessment.Fields.stringField(b,a)},submissionStart:function(a,b){return this.startDatetimeControl.datetime(a,b)},submissionDue:function(a,b){return this.dueDatetimeControl.datetime(a,b)},imageSubmissionEnabled:function(a){var b=$("#openassessment_submission_image_editor",this.settingsElement);return void 0!==a&&(a?b.val(1):b.val(0)),1==b.val()},latexEnabled:function(a){var b=$("#openassessment_submission_latex_editor",this.settingsElement);return void 0!==a&&(a?b.val(1):b.val(0)),1==b.val()},leaderboardNum:function(a){return void 0!==a&&this.leaderboardIntField.set(a),this.leaderboardIntField.get(a)},assessmentsDescription:function(){var a=[],b=this;return $(".openassessment_assessment_module_settings_editor",this.assessmentsElement).each(function(){var c=b.assessmentViews[$(this).attr("id")];if(c.isEnabled()){var d=c.description();d.name=c.name,a.push(d)}}),a},editorAssessmentsOrder:function(){var a=[],b=this;return $(".openassessment_assessment_module_settings_editor",this.assessmentsElement).each(function(){var c=b.assessmentViews[$(this).attr("id")];a.push(c.name)}),a},validate:function(){var a=!0;return a=this.startDatetimeControl.validate()&&a,a=this.dueDatetimeControl.validate()&&a,a=this.leaderboardIntField.validate()&&a,$.each(this.assessmentViews,function(){this.isEnabled()&&(a=this.validate()&&a)}),a},validationErrors:function(){var a=[];return this.startDatetimeControl.validationErrors().length>0&&a.push("Submission start is invalid"),this.dueDatetimeControl.validationErrors().length>0&&a.push("Submission due is invalid"),this.leaderboardIntField.validationErrors().length>0&&a.push("Leaderboard number is invalid"),$.each(this.assessmentViews,function(){a=a.concat(this.validationErrors())}),a},clearValidationErrors:function(){this.startDatetimeControl.clearValidationErrors(),this.dueDatetimeControl.clearValidationErrors(),this.leaderboardIntField.clearValidationErrors(),$.each(this.assessmentViews,function(){this.clearValidationErrors()})}},OpenAssessment.ValidationAlert=function(){this.element=$("#openassessment_validation_alert"),this.editorElement=$(this.element).parent(),this.title=$(".openassessment_alert_title",this.element),this.message=$(".openassessment_alert_message",this.element),this.closeButton=$(".openassessment_alert_close",this.element),this.ALERT_YELLOW="rgb(192, 172, 0)",this.DARK_GREY="#323232"},OpenAssessment.ValidationAlert.prototype={install:function(){var a=this;return this.closeButton.click(function(b){b.preventDefault(),a.hide()}),this},hide:function(){var a=$("#openassessment_editor_header",this.editorElement).outerHeight();this.element.addClass("covered");var b={height:"Calc(100% - "+a+"px)","border-top-right-radius":"3px","border-top-left-radius":"3px"};return $(".oa_editor_content_wrapper",this.editorElement).each(function(){$(this).css(b)}),this},show:function(){var a=this;if(this.isVisible())$(this.element).animate({"background-color":a.ALERT_YELLOW},300,"swing",function(){$(this).animate({"background-color":a.DARK_GREY},700,"swing")});else{this.element.removeClass("covered");var b=this.element.outerHeight(),c=$("#openassessment_editor_header",this.editorElement).outerHeight(),d="Calc(100% - "+(b+c)+"px)",e={height:d,"border-top-right-radius":"0px","border-top-left-radius":"0px"};$(".oa_editor_content_wrapper",this.editorElement).each(function(){$(this).css(e)})}return this},setMessage:function(a,b){return this.title.text(a),this.message.text(b),this},isVisible:function(){return!this.element.hasClass("covered")},getTitle:function(){return this.title.text()},getMessage:function(){return this.message.text()}};