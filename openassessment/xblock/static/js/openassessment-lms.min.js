function OpenAssessmentBlock(a,b){var c=new OpenAssessment.Server(a,b),d=new OpenAssessment.BaseView(a,b,c);d.load()}"undefined"!=typeof OpenAssessment&&OpenAssessment||(OpenAssessment={}),"undefined"==typeof window.gettext&&(window.gettext=function(a){return a}),"undefined"==typeof window.ngetgext&&(window.ngettext=function(a,b,c){return c>1?b:a}),"undefined"==typeof window.Logger&&(window.Logger={log:function(a,b,c){}}),"undefined"==typeof window.MathJax&&(window.MathJax={Hub:{Typeset:function(a){},Queue:function(a){}}}),"undefined"!=typeof OpenAssessment.Server&&OpenAssessment.Server||(OpenAssessment.Server=function(a,b){this.runtime=a,this.element=b},OpenAssessment.Server.prototype={url:function(a){return this.runtime.handlerUrl(this.element,a)},render:function(a){var c=this.url("render_"+a);return $.Deferred(function(a){$.ajax({url:c,type:"POST",dataType:"html"}).done(function(b){a.resolveWith(this,[b])}).fail(function(b){a.rejectWith(this,[gettext("This section could not be loaded.")])})}).promise()},renderLatex:function(a){a.filter(".allow--latex").each(function(){MathJax.Hub.Queue(["Typeset",MathJax.Hub,this])})},renderContinuedPeer:function(){var b=this.url("render_peer_assessment");return $.Deferred(function(a){$.ajax({url:b,type:"POST",dataType:"html",data:{continue_grading:!0}}).done(function(b){a.resolveWith(this,[b])}).fail(function(b){a.rejectWith(this,[gettext("This section could not be loaded.")])})}).promise()},studentInfo:function(a){var b=this.url("render_student_info");return $.Deferred(function(c){$.ajax({url:b,type:"POST",dataType:"html",data:{student_username:a}}).done(function(a){c.resolveWith(this,[a])}).fail(function(a){c.rejectWith(this,[gettext("This section could not be loaded.")])})}).promise()},submit:function(a){var b=this.url("submit");return $.Deferred(function(c){$.ajax({type:"POST",url:b,data:JSON.stringify({submission:a})}).done(function(a){var b=a[0];if(b){var d=a[1],e=a[2];c.resolveWith(this,[d,e])}else{var f=a[1],g=a[2];c.rejectWith(this,[f,g])}}).fail(function(a){c.rejectWith(this,["AJAX",gettext("This response could not be submitted.")])})}).promise()},save:function(a){var b=this.url("save_submission");return $.Deferred(function(c){$.ajax({type:"POST",url:b,data:JSON.stringify({submission:a})}).done(function(a){a.success?c.resolve():c.rejectWith(this,[a.msg])}).fail(function(a){c.rejectWith(this,[gettext("This response could not be saved.")])})}).promise()},submitFeedbackOnAssessment:function(a,b){var c=this.url("submit_feedback"),d=JSON.stringify({feedback_text:a,feedback_options:b});return $.Deferred(function(a){$.ajax({type:"POST",url:c,data:d}).done(function(b){b.success?a.resolve():a.rejectWith(this,[b.msg])}).fail(function(b){a.rejectWith(this,[gettext("This feedback could not be submitted.")])})}).promise()},peerAssess:function(a,b,c,d){var e=this.url("peer_assess"),f=JSON.stringify({options_selected:a,criterion_feedback:b,overall_feedback:c,submission_uuid:d});return $.Deferred(function(a){$.ajax({type:"POST",url:e,data:f}).done(function(b){b.success?a.resolve():a.rejectWith(this,[b.msg])}).fail(function(b){a.rejectWith(this,[gettext("This assessment could not be submitted.")])})}).promise()},selfAssess:function(a,b,c){var d=this.url("self_assess"),e=JSON.stringify({options_selected:a,criterion_feedback:b,overall_feedback:c});return $.Deferred(function(a){$.ajax({type:"POST",url:d,data:e}).done(function(b){b.success?a.resolve():a.rejectWith(this,[b.msg])}).fail(function(b){a.rejectWith(this,[gettext("This assessment could not be submitted.")])})})},trainingAssess:function(a){var b=this.url("training_assess"),c=JSON.stringify({options_selected:a});return $.Deferred(function(a){$.ajax({type:"POST",url:b,data:c}).done(function(b){b.success?a.resolveWith(this,[b.corrections]):a.rejectWith(this,[b.msg])}).fail(function(b){a.rejectWith(this,[gettext("This assessment could not be submitted.")])})})},scheduleTraining:function(){var a=this.url("schedule_training");return $.Deferred(function(b){$.ajax({type:"POST",url:a,data:'""'}).done(function(a){a.success?b.resolveWith(this,[a.msg]):b.rejectWith(this,[a.msg])}).fail(function(a){b.rejectWith(this,[gettext("This assessment could not be submitted.")])})})},rescheduleUnfinishedTasks:function(){var a=this.url("reschedule_unfinished_tasks");return $.Deferred(function(b){$.ajax({type:"POST",url:a,data:'""'}).done(function(a){a.success?b.resolveWith(this,[a.msg]):b.rejectWith(this,[a.msg])}).fail(function(a){b.rejectWith(this,[gettext("One or more rescheduling tasks failed.")])})})},updateEditorContext:function(a){var b=this.url("update_editor_context"),c=JSON.stringify({prompts:a.prompts,feedback_prompt:a.feedbackPrompt,feedback_default_text:a.feedback_default_text,title:a.title,submission_start:a.submissionStart,submission_due:a.submissionDue,criteria:a.criteria,assessments:a.assessments,editor_assessments_order:a.editorAssessmentsOrder,allow_file_upload:a.imageSubmissionEnabled,allow_latex:a.latexEnabled,leaderboard_show:a.leaderboardNum});return $.Deferred(function(a){$.ajax({type:"POST",url:b,data:c}).done(function(b){b.success?a.resolve():a.rejectWith(this,[b.msg])}).fail(function(b){a.rejectWith(this,[gettext("This problem could not be saved.")])})}).promise()},checkReleased:function(){var a=this.url("check_released"),b='""';return $.Deferred(function(c){$.ajax({type:"POST",url:a,data:b}).done(function(a){a.success?c.resolveWith(this,[a.is_released]):c.rejectWith(this,[a.msg])}).fail(function(a){c.rejectWith(this,[gettext("The server could not be contacted.")])})}).promise()},getUploadUrl:function(a){var b=this.url("upload_url");return $.Deferred(function(c){$.ajax({type:"POST",url:b,data:JSON.stringify({contentType:a})}).done(function(a){a.success?c.resolve(a.url):c.rejectWith(this,[a.msg])}).fail(function(a){c.rejectWith(this,[gettext("Could not retrieve upload url.")])})}).promise()},getDownloadUrl:function(){var a=this.url("download_url");return $.Deferred(function(b){$.ajax({type:"POST",url:a,data:JSON.stringify({})}).done(function(a){a.success?b.resolve(a.url):b.rejectWith(this,[a.msg])}).fail(function(a){b.rejectWith(this,[gettext("Could not retrieve download url.")])})}).promise()},cancelSubmission:function(a,b){var c=this.url("cancel_submission"),d=JSON.stringify({submission_uuid:a,comments:b});return $.Deferred(function(a){$.ajax({type:"POST",url:c,data:d}).done(function(b){b.success?a.resolveWith(this,[b.msg]):a.rejectWith(this,[b.msg])}).fail(function(b){a.rejectWith(this,[gettext("The submission could not be removed from the grading pool.")])})}).promise()}}),"undefined"!=typeof OpenAssessment&&OpenAssessment||(OpenAssessment={}),"undefined"==typeof window.gettext&&(window.gettext=function(a){return a}),"undefined"==typeof window.ngetgext&&(window.ngettext=function(a,b,c){return c>1?b:a}),"undefined"==typeof window.Logger&&(window.Logger={log:function(a,b,c){}}),"undefined"==typeof window.MathJax&&(window.MathJax={Hub:{Typeset:function(a){},Queue:function(a){}}}),OpenAssessment.BaseView=function(a,b,c){this.runtime=a,this.element=b,this.server=c,this.fileUploader=new OpenAssessment.FileUploader,this.responseView=new OpenAssessment.ResponseView(this.element,this.server,this.fileUploader,this),this.trainingView=new OpenAssessment.StudentTrainingView(this.element,this.server,this),this.selfView=new OpenAssessment.SelfView(this.element,this.server,this),this.peerView=new OpenAssessment.PeerView(this.element,this.server,this),this.gradeView=new OpenAssessment.GradeView(this.element,this.server,this),this.leaderboardView=new OpenAssessment.LeaderboardView(this.element,this.server,this),this.messageView=new OpenAssessment.MessageView(this.element,this.server,this),this.staffInfoView=new OpenAssessment.StaffInfoView(this.element,this.server,this)},OpenAssessment.BaseView.prototype={scrollToTop:function(){$.scrollTo instanceof Function&&$(window).scrollTo($("#openassessment__steps",this.element),800,{offset:-50})},setUpCollapseExpand:function(a){a.on("click",".ui-toggle-visibility__control",function(a){var b=$(a.target).closest(".ui-toggle-visibility");b.toggleClass("is--collapsed")})},load:function(){this.responseView.load(),this.loadAssessmentModules(),this.staffInfoView.load()},loadAssessmentModules:function(){this.trainingView.load(),this.peerView.load(),this.selfView.load(),this.gradeView.load(),this.leaderboardView.load()},loadMessageView:function(){this.messageView.load()},toggleActionError:function(a,b){var c=this.element,d=null;if("save"==a?d=".response__submission__actions":"submit"==a||"peer"==a||"self"==a||"student-training"==a?d=".step__actions":"feedback_assess"==a?d=".submission__feedback__actions":"upload"==a&&(d="#upload__error"),null===d)null!==b&&console.log(b);else{var e=null===b?"":b;$(d+" .message__content",c).html("<p>"+e+"</p>"),$(d,c).toggleClass("has--error",null!==b)}},showLoadError:function(a){var b="#openassessment__"+a;$(b).toggleClass("has--error",!0),$(b+" .step__status__value i").removeClass().addClass("ico icon-warning-sign"),$(b+" .step__status__value .copy").html(gettext("Unable to Load"))}},OpenAssessment.FileUploader=function(){this.upload=function(a,b){return $.Deferred(function(c){$.ajax({url:a,type:"PUT",data:b,async:!1,processData:!1,contentType:b.type}).done(function(a,d,e){Logger.log("openassessment.upload_file",{fileName:b.name,fileSize:b.size,fileType:b.type}),c.resolve()}).fail(function(a,b,d){c.rejectWith(this,[b])})}).promise()}},OpenAssessment.GradeView=function(a,b,c){this.element=a,this.server=b,this.baseView=c},OpenAssessment.GradeView.prototype={load:function(){var a=this,b=this.baseView;this.server.render("grade").done(function(b){$("#openassessment__grade",a.element).replaceWith(b),a.server.renderLatex($("#openassessment__grade",a.element)),a.installHandlers()}).fail(function(a){b.showLoadError("grade",a)})},installHandlers:function(){var a=$("#openassessment__grade",this.element);this.baseView.setUpCollapseExpand(a);var b=this;a.find("#feedback__submit").click(function(a){a.preventDefault(),b.submitFeedbackOnAssessment()})},feedbackText:function(a){return"undefined"==typeof a?$("#feedback__remarks__value",this.element).val():void $("#feedback__remarks__value",this.element).val(a)},feedbackOptions:function(a){var b=this;return"undefined"==typeof a?$.map($(".feedback__overall__value:checked",b.element),function(a,b){return $(a).val()}):($(".feedback__overall__value",this.element).prop("checked",!1),void $.each(a,function(a,c){$("#feedback__overall__value--"+c,b.element).prop("checked",!0)}))},setHidden:function(a,b){a.toggleClass("is--hidden",b),a.attr("aria-hidden",b?"true":"false")},isHidden:function(a){return a.hasClass("is--hidden")&&"true"==a.attr("aria-hidden")},feedbackState:function(a){var b=$(".submission__feedback__content",this.element),c=b.find(".submission__feedback__instructions"),d=b.find(".submission__feedback__fields"),e=b.find(".submission__feedback__actions"),f=b.find(".transition__status"),g=b.find(".message--complete");if("undefined"==typeof a){var h=b.hasClass("is--transitioning")&&b.hasClass("is--submitting")&&!this.isHidden(f)&&this.isHidden(g)&&this.isHidden(c)&&this.isHidden(d)&&this.isHidden(e),i=b.hasClass("is--submitted")&&this.isHidden(f)&&!this.isHidden(g)&&this.isHidden(c)&&this.isHidden(d)&&this.isHidden(e),j=!b.hasClass("is--submitted")&&!b.hasClass("is--transitioning")&&!b.hasClass("is--submitting")&&this.isHidden(f)&&this.isHidden(g)&&!this.isHidden(c)&&!this.isHidden(d)&&!this.isHidden(e);if(j)return"open";if(h)return"submitting";if(i)return"submitted";throw"Invalid feedback state"}"open"==a?(b.toggleClass("is--transitioning",!1),b.toggleClass("is--submitting",!1),b.toggleClass("is--submitted",!1),this.setHidden(c,!1),this.setHidden(d,!1),this.setHidden(e,!1),this.setHidden(f,!0),this.setHidden(g,!0)):"submitting"==a?(b.toggleClass("is--transitioning",!0),b.toggleClass("is--submitting",!0),b.toggleClass("is--submitted",!1),this.setHidden(c,!0),this.setHidden(d,!0),this.setHidden(e,!0),this.setHidden(f,!1),this.setHidden(g,!0)):"submitted"==a&&(b.toggleClass("is--transitioning",!1),b.toggleClass("is--submitting",!1),b.toggleClass("is--submitted",!0),this.setHidden(c,!0),this.setHidden(d,!0),this.setHidden(e,!0),this.setHidden(f,!0),this.setHidden(g,!1))},submitFeedbackOnAssessment:function(){var a=this,b=this.baseView;$("#feedback__submit",this.element).toggleClass("is--disabled",!0),a.feedbackState("submitting"),this.server.submitFeedbackOnAssessment(this.feedbackText(),this.feedbackOptions()).done(function(){a.feedbackState("submitted")}).fail(function(a){b.toggleActionError("feedback_assess",a)})}},OpenAssessment.LeaderboardView=function(a,b,c){this.element=a,this.server=b,this.baseView=c},OpenAssessment.LeaderboardView.prototype={load:function(){var a=this,b=this.baseView;this.server.render("leaderboard").done(function(b){$("#openassessment__leaderboard",a.element).replaceWith(b),a.server.renderLatex($("#openassessment__leaderboard",a.element))}).fail(function(a){b.showLoadError("leaderboard",a)})}},OpenAssessment.MessageView=function(a,b,c){this.element=a,this.server=b,this.baseView=c},OpenAssessment.MessageView.prototype={load:function(){var a=this,b=this.baseView;this.server.render("message").done(function(b){$("#openassessment__message",a.element).replaceWith(b),a.server.renderLatex($("#openassessment__message",a.element))}).fail(function(a){b.showLoadError("message",a)})}},OpenAssessment.PeerView=function(a,b,c){this.element=a,this.server=b,this.baseView=c,this.rubric=null},OpenAssessment.PeerView.prototype={load:function(){var a=this;this.server.render("peer_assessment").done(function(b){$("#openassessment__peer-assessment",a.element).replaceWith(b),a.server.renderLatex($("#openassessment__peer-assessment",a.element)),a.installHandlers(!1)}).fail(function(b){a.baseView.showLoadError("peer-assessment")}),a.baseView.loadMessageView()},loadContinuedAssessment:function(){var a=this;a.continueAssessmentEnabled(!1),this.server.renderContinuedPeer().done(function(b){$("#openassessment__peer-assessment",a.element).replaceWith(b),a.server.renderLatex($("#openassessment__peer-assessment",a.element)),a.installHandlers(!0)}).fail(function(b){a.baseView.showLoadError("peer-assessment"),a.continueAssessmentEnabled(!0)})},continueAssessmentEnabled:function(a){var b=$("#peer-assessment__continue__grading",this.element);return"undefined"==typeof a?!b.hasClass("is--disabled"):void b.toggleClass("is--disabled",!a)},installHandlers:function(a){var b=$("#openassessment__peer-assessment",this.element),c=this;this.baseView.setUpCollapseExpand(b);var d=$("#peer-assessment--001__assessment",this.element);if(d.size()>0){var e=d.get(0);this.rubric=new OpenAssessment.Rubric(e)}null!==this.rubric&&this.rubric.canSubmitCallback($.proxy(c.peerSubmitEnabled,c)),b.find("#peer-assessment--001__assessment__submit").click(function(b){b.preventDefault(),a?c.continuedPeerAssess():c.peerAssess()}),b.find("#peer-assessment__continue__grading").click(function(a){a.preventDefault(),c.loadContinuedAssessment()})},peerSubmitEnabled:function(a){var b=$("#peer-assessment--001__assessment__submit",this.element);return"undefined"==typeof a?!b.hasClass("is--disabled"):void b.toggleClass("is--disabled",!a)},peerAssess:function(){var a=this,b=a.baseView;this.peerAssessRequest(function(){b.loadAssessmentModules(),b.scrollToTop()})},continuedPeerAssess:function(){var a=this,b=this.baseView.gradeView,c=a.baseView;a.peerAssessRequest(function(){a.loadContinuedAssessment(),b.load(),c.scrollToTop()})},peerAssessRequest:function(a){var b=this,c=$("#openassessment__peer-assessment").data("submission-uuid");b.baseView.toggleActionError("peer",null),b.peerSubmitEnabled(!1),this.server.peerAssess(this.rubric.optionsSelected(),this.rubric.criterionFeedback(),this.rubric.overallFeedback(),c).done(a).fail(function(a){b.baseView.toggleActionError("peer",a),b.peerSubmitEnabled(!0)})}},OpenAssessment.ResponseView=function(a,b,c,d){this.element=a,this.server=b,this.fileUploader=c,this.baseView=d,this.savedResponse=[],this.files=null,this.imageType=null,this.lastChangeTime=Date.now(),this.errorOnLastSave=!1,this.autoSaveTimerId=null},OpenAssessment.ResponseView.prototype={AUTO_SAVE_POLL_INTERVAL:2e3,AUTO_SAVE_WAIT:3e4,MAX_FILE_SIZE:5242880,load:function(){var a=this;this.server.render("submission").done(function(b){$("#openassessment__response",a.element).replaceWith(b),a.server.renderLatex($("#openassessment__response",a.element)),a.installHandlers(),a.setAutoSaveEnabled(!0)}).fail(function(b){a.baseView.showLoadError("response")})},installHandlers:function(){var a=$("#openassessment__response",this.element),b=this;this.baseView.setUpCollapseExpand(a),this.savedResponse=this.response();var c=function(a){b.handleResponseChanged()};a.find(".submission__answer__part__text__value").on("change keyup drop paste",c);var d=function(a){b.prepareUpload(a.target.files)};a.find("input[type=file]").on("change",d),a.find("#submission__preview__item").hide(),a.find("#step--response__submit").click(function(a){a.preventDefault(),b.submit()}),a.find("#submission__save").click(function(a){a.preventDefault(),b.save()}),a.find("#submission__preview").click(function(b){b.preventDefault();var c=a.find("#submission__answer__value").val(),d=a.find("#preview_content");d.html(c.replace(/\r\n|\r|\n/g,"<br />")),a.find("#submission__preview__item").show(),MathJax.Hub.Queue(["Typeset",MathJax.Hub,d[0]])}),a.find("#file__upload").click(function(a){a.preventDefault(),$(".submission__answer__display__image",b.element).removeClass("is--hidden"),b.fileUpload()})},setAutoSaveEnabled:function(a){a?null===this.autoSaveTimerId&&(this.autoSaveTimerId=setInterval($.proxy(this.autoSave,this),this.AUTO_SAVE_POLL_INTERVAL)):null!==this.autoSaveTimerId&&clearInterval(this.autoSaveTimerId)},submitEnabled:function(a){var b=$("#step--response__submit",this.element);return"undefined"==typeof a?!b.hasClass("is--disabled"):void b.toggleClass("is--disabled",!a)},saveEnabled:function(a){var b=$("#submission__save",this.element);return"undefined"==typeof a?!b.hasClass("is--disabled"):void b.toggleClass("is--disabled",!a)},previewEnabled:function(a){var b=$("#submission__preview",this.element);return"undefined"==typeof a?!b.hasClass("is--disabled"):void b.toggleClass("is--disabled",!a)},saveStatus:function(a){var b=$("#response__save_status h3",this.element);if("undefined"==typeof a)return b.text();var c=gettext("Status of Your Response");b.html('<span class="sr">'+c+":</span>\n"+a)},unsavedWarningEnabled:function(a){return"undefined"==typeof a?null!==window.onbeforeunload:void(a?window.onbeforeunload=function(){return gettext("If you leave this page without saving or submitting your response, you'll lose any work you've done on the response.")}:window.onbeforeunload=null)},response:function(a){var b=$(".submission__answer__part__text__value",this.element);return"undefined"==typeof a?b.map(function(){return $.trim($(this).val())}).get():void b.map(function(b,c){$(this).val(a[b])})},responseChanged:function(){var a=this.savedResponse;return this.response().some(function(b,c,d){return b!==a[c]})},autoSave:function(){var a=Date.now()-this.lastChangeTime;this.responseChanged()&&a>this.AUTO_SAVE_WAIT&&!this.errorOnLastSave&&this.save()},handleResponseChanged:function(){var a=!this.response().every(function(a,b,c){return""==$.trim(a)});this.submitEnabled(a),this.responseChanged()&&(this.saveEnabled(a),this.previewEnabled(a),this.saveStatus(gettext("This response has not been saved.")),this.unsavedWarningEnabled(!0)),this.lastChangeTime=Date.now()},save:function(){this.errorOnLastSave=!1,this.saveStatus(gettext("Saving...")),this.baseView.toggleActionError("save",null),this.unsavedWarningEnabled(!1);var a=this,b=this.response();this.server.save(b).done(function(){a.savedResponse=b;var c=a.response(),d=c.every(function(a,b,c){return""==a});a.submitEnabled(!d);var e=c.every(function(a,c,d){return a===b[c]});e&&(a.saveEnabled(!1),a.saveStatus(gettext("This response has been saved but not submitted.")))}).fail(function(b){a.saveStatus(gettext("Error")),a.baseView.toggleActionError("save",b),a.errorOnLastSave=!0})},submit:function(){this.submitEnabled(!1);var a=this,b=this.baseView;this.confirmSubmission().pipe(function(){var c=a.response();return b.toggleActionError("response",null),a.server.submit(c)}).done($.proxy(a.moveToNextStep,a)).fail(function(c,d){"ENOMULTI"==c?a.moveToNextStep():(d&&b.toggleActionError("submit",d),a.submitEnabled(!0))})},moveToNextStep:function(){this.load(),this.baseView.loadAssessmentModules(),this.unsavedWarningEnabled(!1)},confirmSubmission:function(){var a=gettext("You're about to submit your response for this assignment. After you submit this response, you can't change it or submit a new response.");return $.Deferred(function(b){confirm(a)?b.resolve():b.reject()})},prepareUpload:function(a){this.files=null,this.imageType=a[0].type,a[0].size>this.MAX_FILE_SIZE?this.baseView.toggleActionError("upload",gettext("File size must be 5MB or less.")):"application/pdf"!=this.imageType?this.baseView.toggleActionError("upload",gettext("File must be an image.")):(this.baseView.toggleActionError("upload",null),this.files=a),$("#file__upload").toggleClass("is--disabled",null===this.files)},fileUpload:function(){var a=this,b=$("#file__upload");b.addClass("is--disabled");var c=function(c){a.baseView.toggleActionError("upload",c),b.removeClass("is--disabled")};this.imageType="image/png",this.server.getUploadUrl(a.imageType).done(function(b){var d=a.files[0];a.fileUploader.upload(b,d).done(function(){a.imageUrl(),a.baseView.toggleActionError("upload",null)}).fail(c)}).fail(c)},imageUrl:function(){var a=this,b=$("#submission__answer__image",a.element);a.server.getDownloadUrl().done(function(a){return b.attr("src",a),a})}},OpenAssessment.Rubric=function(a){this.element=a},OpenAssessment.Rubric.prototype={criterionFeedback:function(a){var b="textarea.answer__value",c={};return $(b,this.element).each(function(b,d){"undefined"!=typeof a?($(d).val(a[d.name]),c[d.name]=a[d.name]):c[d.name]=$(d).val()}),c},overallFeedback:function(a){var b="#assessment__rubric__question--feedback__value";return"undefined"==typeof a?$(b,this.element).val():void $(b,this.element).val(a)},optionsSelected:function(a){var b="input[type=radio]";if("undefined"==typeof a){var c={};return $(b+":checked",this.element).each(function(a,b){c[b.name]=b.value}),c}$(b,this.element).prop("checked",!1),$(b,this.element).each(function(b,c){a.hasOwnProperty(c.name)&&c.value==a[c.name]&&$(c).prop("checked",!0)})},canSubmitCallback:function(a){var b=this;a(b.canSubmit()),$(this.element).on("change keyup drop paste",function(){a(b.canSubmit())})},canSubmit:function(){var a=$("input[type=radio]:checked",this.element).length,b=$(".field--radio.assessment__rubric__question.has--options",this.element).length,c=!0;return $("textarea[required]",this.element).each(function(){var a=$.trim($(this).val());""===a&&(c=!1)}),a==b&&c},showCorrections:function(a){var b="input[type=radio]",c=!1;return $(b,this.element).each(function(b,d){var e=$(d).parents(".assessment__rubric__question");a.hasOwnProperty(d.name)?(c=!0,e.find(".message--incorrect").removeClass("is--hidden"),e.find(".message--correct").addClass("is--hidden")):(e.find(".message--correct").removeClass("is--hidden"),e.find(".message--incorrect").addClass("is--hidden"))}),c}},OpenAssessment.SelfView=function(a,b,c){this.element=a,this.server=b,this.baseView=c,this.rubric=null},OpenAssessment.SelfView.prototype={load:function(){var a=this;this.server.render("self_assessment").done(function(b){$("#openassessment__self-assessment",a.element).replaceWith(b),a.server.renderLatex($("#openassessment__self-assessment",a.element)),a.installHandlers()}).fail(function(b){a.showLoadError("self-assessment")})},installHandlers:function(){var a=this,b=$("#openassessment__self-assessment",a.element);this.baseView.setUpCollapseExpand(b);var c=$("#self-assessment--001__assessment",this.element);if(c.size()>0){var d=c.get(0);this.rubric=new OpenAssessment.Rubric(d)}null!==this.rubric&&this.rubric.canSubmitCallback($.proxy(this.selfSubmitEnabled,this)),b.find("#self-assessment--001__assessment__submit").click(function(b){b.preventDefault(),a.selfAssess()})},selfSubmitEnabled:function(a){var b=$("#self-assessment--001__assessment__submit",this.element);return"undefined"==typeof a?!b.hasClass("is--disabled"):void b.toggleClass("is--disabled",!a)},selfAssess:function(){var a=this,b=this.baseView;b.toggleActionError("self",null),a.selfSubmitEnabled(!1),this.server.selfAssess(this.rubric.optionsSelected(),this.rubric.criterionFeedback(),this.rubric.overallFeedback()).done(function(){b.loadAssessmentModules(),b.scrollToTop()}).fail(function(c){b.toggleActionError("self",c),a.selfSubmitEnabled(!0)})}},OpenAssessment.StaffInfoView=function(a,b,c){this.element=a,this.server=b,this.baseView=c},OpenAssessment.StaffInfoView.prototype={load:function(){var a=this;$("#openassessment__staff-info",a.element).length>0&&this.server.render("staff_info").done(function(b){$("#openassessment__staff-info",a.element).replaceWith(b),a.server.renderLatex($("#openassessment__staff-info",a.element)),a.installHandlers()}).fail(function(b){a.baseView.showLoadError("staff_info")})},loadStudentInfo:function(){var a=this,b=$("#openassessment__staff-info",this.element),c=b.find("#openassessment__student_username").val();this.server.studentInfo(c).done(function(b){$("#openassessment__student-info",a.element).replaceWith(b);var c=$("#openassessment__staff-info__cancel__submission",this.element);c.on("click","#submit_cancel_submission",function(b){b.preventDefault(),a.cancelSubmission($(this).data("submission-uuid"))});var d=function(b){a.handleCommentChanged()};c.find("#staff-info__cancel-submission__comments").on("change keyup drop paste",d)}).fail(function(b){a.showLoadError("student_info")})},installHandlers:function(){var a=$("#openassessment__staff-info",this.element),b=$("#openassessment__student-info",this.element),c=this;a.length<=0||(this.baseView.setUpCollapseExpand(a,function(){}),this.baseView.setUpCollapseExpand(b,function(){}),a.find("#openassessment_student_info_form").submit(function(a){a.preventDefault(),c.loadStudentInfo()}),a.find("#submit_student_username").click(function(a){a.preventDefault(),c.loadStudentInfo()}),a.find("#schedule_training").click(function(a){a.preventDefault(),c.scheduleTraining()}),a.find("#reschedule_unfinished_tasks").click(function(a){a.preventDefault(),c.rescheduleUnfinishedTasks()}))},scheduleTraining:function(){this.server.scheduleTraining().done(function(a){$("#schedule_training_message",this.element).text(a)}).fail(function(a){$("#schedule_training_message",this.element).text(a)})},rescheduleUnfinishedTasks:function(){this.server.rescheduleUnfinishedTasks().done(function(a){$("#reschedule_unfinished_tasks_message",this.element).text(a)}).fail(function(a){$("#reschedule_unfinished_tasks_message",this.element).text(a)})},cancelSubmission:function(a){this.cancelSubmissionEnabled(!1);var b=this,c=$("#openassessment__student-info",this.element),d=c.find("#staff-info__cancel-submission__comments").val();this.server.cancelSubmission(a,d).done(function(a){$(".cancel-submission-error").html(""),$("#openassessment__staff-info__cancel__submission",b.element).html(a)}).fail(function(a){$(".cancel-submission-error").html(a)})},cancelSubmissionEnabled:function(a){var b=$("#submit_cancel_submission",this.element);return"undefined"==typeof a?!b.hasClass("is--disabled"):void b.toggleClass("is--disabled",!a)},comment:function(a){var b=$("#staff-info__cancel-submission__comments",this.element);return"undefined"==typeof a?b.val():void b.val(a)},handleCommentChanged:function(){var a=""!==$.trim(this.comment());this.cancelSubmissionEnabled(a)}},OpenAssessment.StudentTrainingView=function(a,b,c){this.element=a,this.server=b,this.baseView=c,this.rubric=null},OpenAssessment.StudentTrainingView.prototype={load:function(){var a=this;this.server.render("student_training").done(function(b){$("#openassessment__student-training",a.element).replaceWith(b),a.server.renderLatex($("#openassessment__student-training",a.element)),a.installHandlers()}).fail(function(b){a.baseView.showLoadError("student-training")})},installHandlers:function(){var a=$("#openassessment__student-training",this.element),b=this;this.baseView.setUpCollapseExpand(a);var c=$("#student-training--001__assessment",this.element);if(c.size()>0){var d=c.get(0);this.rubric=new OpenAssessment.Rubric(d)}null!==this.rubric&&this.rubric.canSubmitCallback($.proxy(this.assessButtonEnabled,this)),a.find("#student-training--001__assessment__submit").click(function(a){a.preventDefault(),b.assess()})},assess:function(){this.assessButtonEnabled(!1);var a={};null!==this.rubric&&(a=this.rubric.optionsSelected());var b=this,c=this.baseView;this.server.trainingAssess(a).done(function(a){var d=$("#openassessment__student-training--incorrect",this.element),e=$("#openassessment__student-training--instructions",this.element);b.rubric.showCorrections(a)?(e.addClass("is--hidden"),d.removeClass("is--hidden")):(b.load(),c.loadAssessmentModules(),d.addClass("is--hidden"),e.removeClass("is--hidden")),c.scrollToTop()}).fail(function(a){c.toggleActionError("student-training",a),b.assessButtonEnabled(!0)})},assessButtonEnabled:function(a){var b=$("#student-training--001__assessment__submit",this.element);return"undefined"==typeof a?!b.hasClass("is--disabled"):void b.toggleClass("is--disabled",!a)}};